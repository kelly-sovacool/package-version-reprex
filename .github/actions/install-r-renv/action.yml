name: Install R + renv
description: |
  Install R and dependencies with renv
inputs:
  r-version:
    description: "The version of R to install"
    default: "release"
  renv-profile:
    default: '"dev"'
  http-user-agent:
    default: ""
  use-public-rspm:
    default: true

runs:
  using: "composite"
  steps:
    - name: install ubuntu deps
      shell: bash
      run: |
        sudo apt-get update
        sudo apt-get install -y libcurl4-openssl-dev pandoc

    - uses: r-lib/actions/setup-pandoc@v2

    - uses: r-lib/actions/setup-r@v2
      with:
        r-version: ${{ inputs.r-version }}
        http-user-agent: ${{ inputs.http-user-agent }}
        use-public-rspm: ${{ inputs.use-public-rspm }}

    - name: initialize renv
      shell: Rscript {0}
      run: |
        if (!requireNamespace("renv", quietly = TRUE)) {
          install.packages("renv")
        }
        renv::init(profile = ${{ inputs.renv-profile }}, bioconductor = TRUE)

    - uses: r-lib/actions/setup-renv@v2
      with:
        profile: '${{ inputs.renv-profile }}'
